---
categories:  
- ""    #the front matter should be like the one found in, e.g., blog2.md. It cannot be like the normal Rmd we used
- ""
date: "2021-09-30"
description: Brussels # the title that will show up once someone gets to this page
draft: false
image:  # save picture in \static\img\blogs. Acceptable formats= jpg, jpeg, or png . Your iPhone pics wont work

keywords: ""
slug: brussels # slug is the shorthand URL address... no spaces plz
title: List of properties and their mapping
---
  



```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```


```{r load-libraries, echo=FALSE}
rm(list = ls())
library(tidyverse) # the usual stuff: dplyr, readr, and other goodies
library(lubridate) # to handle dates
library(GGally) # for correlation-scatter plot matrix
library(ggfortify) # to produce residual diagnostic plots
library(rsample) # to split dataframe in training- & testing sets
library(janitor) # clean_names()
library(broom) # use broom:augment() to get tidy table with regression output, residuals, etc
library(huxtable) # to get summary table of all models produced
library(kableExtra) # for formatting tables
library(moderndive) # for getting regression tables
library(skimr) # for skim
library(mosaic)
library(leaflet) # for interactive HTML maps
library(tidytext)
library(viridis)
library(leaps)
library(vroom)
```
## Propery types


Next, we look at the variable `property_type`. We can use the `count` function to determine how many categories there are their frequency. What are the top 4 most common property types? What proportion of the total listings do they make up? 

Since the vast majority of the observations in the data are one of the top four or five property types, we would like to create a simplified version of `property_type` variable that has 5 categories: the top four categories and `Other`. Fill in the code below to create `prop_type_simplified`.

```{r}
listings <- listings %>%
  mutate(prop_type_simplified = case_when(
    property_type %in% c("Entire rental unit","Private room in rental unit", "Entire condominium (condo)","Private room in residential home") ~ property_type, 
    TRUE ~ "Other"
  ))
  
```
Use the code below to check that `prop_type_simplified` was correctly made.

```{r}
listings %>%
  count(property_type, prop_type_simplified) %>%
  arrange(desc(n))      

#delete the variable we no longer need:
listings$property_type <- NULL
```        
Airbnb is most commonly used for travel purposes, i.e., as an alternative to traditional hotels. We only want to include  listings in our regression analysis that are intended for travel purposes:

- What are the  most common values for the variable `minimum_nights`? 
```{r}

listings %>% group_by(minimum_nights) %>% summarize(values = count(minimum_nights)) %>% arrange(desc(values))
```
- Is ther any value among the common values that stands out? 

**Answer**: the value of 90 days, which likely stands out as a proxy to long-term rent.


- What is the likely intended purpose for Airbnb listings with this seemingly unusual value for `minimum_nights`?

**Answer**: Long-term rent

Filter the airbnb data so that it only includes observations with `minimum_nights <= 4`

```{r}
listings <- listings %>% filter(minimum_nights <= 4)

 

```
        
# Mapping 

Visualisations of feature distributions and their relations are key to understanding a data set, and they can open up new lines of exploration. While we do not have time to go into all the wonderful geospatial visualisations one can do with R, you can use the following code to start with a map of your city, and overlay all AirBnB coordinates to get an overview of the spatial distribution of AirBnB rentals. For this visualisation we use the `leaflet` package, which includes a variety of tools for interactive maps, so you can easily zoom in-out, click on a point to get the actual AirBnB listing for that specific point, etc.

The following code, having downloaded a dataframe `listings` with all AirbnB listings in Milan, will plot on the map all AirBnBs where `minimum_nights` is less than equal to four (4). You could learn more about `leaflet`, by following [the relevant Datacamp course on mapping with leaflet](https://www.datacamp.com/courses/interactive-maps-with-leaflet-in-r)

**Note:** below we added the visualization with a heatmap (i.e. color is differentiated depending on the price of accomodation)

```{r, out.width = '80%'}

#Create a heatmap of the prices:
listings$price_cuts <- cut(listings$price, 
                        quantile(listings$price), include.lowest = T,
                        labels = c('<50%', '50-100%', '100-150%', '150-200%'))
heatmap_colors <- colorFactor(palette = 'RdYlGn', listings$price_cuts)

leaflet(data = filter(listings, minimum_nights <= 4)) %>% 
  addProviderTiles("OpenStreetMap.Mapnik") %>% 
  addCircleMarkers(lng = ~longitude, 
                   lat = ~latitude, 
                   radius = 1, 
                   color = ~heatmap_colors(listings$price_cuts), 
                   fillOpacity = 0.3, 
                   popup = ~listing_url,
                   label = ~prop_type_simplified)
#delete the redundant column:
listings$price_cuts <- NULL


#Note - we need to add legend to this :)
```